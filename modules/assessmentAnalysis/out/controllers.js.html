<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>angular.module("assessmentAnalysis")
    //
    .controller("AssessmentListController", ["$scope", "AssessmentFactory", "$timeout",
        function ($scope, AssessmentFactory, $timeout) {
            $scope.assessments = [];
            AssessmentFactory.getAssessmentList().then(
                function (response) {
                    $scope.assessments = response;
                }
            );
        }
    ])
    //
    .controller("SendAnswersController", ["$scope", "$stateParams", "AssessmentFactory",
        function ($scope, $stateParams, AssessmentFactory) {

            $scope.currentAssessment = {};
            $scope.userAnswers = {
                username: "",
                assessmentId: "",
                answerList: []
            };
            /**
             * Fazer o download de $scope.currentAssessment e montar o $scope.userAnswers
             */
            AssessmentFactory.getAssessment($stateParams.assessmentId).then(
                function (response) {
                    /**
                     * Montar o objeto de respostas do usuário
                     */
                    $scope.currentAssessment = response;
                    $scope.userAnswers.assessmentId = $scope.currentAssessment.assessmentId;
                    $scope.currentAssessment.questions.forEach(
                        function (current, index, array) {
                            $scope.userAnswers.answerList[index] = {
                                questionNumber: current.questionNumber,
                                answer: ""
                            };
                        }
                    );
                }
            );
            /**
             * Enviar gabarito do usuário (ou pedir que ele corrija algo errado)
             */
            $scope.submitUserAnswers = function () {
                /**
                 * Verificar se há algum erro com o objeto $scope.userAnswers, antes de enviar
                 */
                var thereIsError = false;
                (function () {
                    var errorMessage = "";
                    if (!$scope.userAnswers || !$scope.userAnswers.answerList) {
                        alert("O site corrompeu algum dado.\nRecarregue a página");
                        thereIsError = true;
                        return;
                    }
                    if (!$scope.userAnswers.username) {
                        errorMessage += "Não pode enviar sem seu nome !\n";
                        thereIsError = true;
                    }
                    $scope.userAnswers.answerList.forEach(function (current, index, array) {
                        if (!current.answer) {
                            errorMessage += "A questão " + current.questionNumber + " ficou sem resposta" + "\n";
                            thereIsError = true;
                            return;
                        }
                    });
                    if (errorMessage) {
                        alert(errorMessage);
                    }
                }());

                if (!thereIsError) {
                    AssessmentFactory.uploadAnswers($scope.userAnswers).then(function () {
                        alert("Resposta enviadas muito bem!");
                    }, function (response) {
                        alert("Houve erro no envio.\nContate um admin.");
                    });
                }
            };
        }
    ])
    //
    .controller("UserListController", ["$scope", "$stateParams", "StatisticsFactory",
        function ($scope, $stateParams, StatisticsFactory) {
            $scope.userList = StatisticsFactory.getUserList($stateParams.assessmentId);
        }
    ])
    //
    .controller("EvaluatedAnswersController", ["$scope", "StatisticsFactory", "$stateParams",
        function ($scope, StatisticsFactory, $stateParams) {

            $scope.evaluatedQuestionList = [];
            StatisticsFactory.getEvaluatedQuestions($stateParams.assessmentId, $stateParams.username).then(
                function (response) {
                    $scope.evaluatedQuestionList = response;
                    $scope.correctCount = (function () {
                        var count = 0;
                        $scope.evaluatedQuestionList.forEach(
                            function (current, index, array) {
                                current.correctAnswer === current.userAnswer ? count++ : null;
                            }
                        );
                        return count;
                    })();
                }
            );

            /**
             * No painel "Por disciplina", esta variável corresponde à forma de análise escolhida. Por default, é o primeiro tipo
             */
            $scope.analysisBySubject = 1;


            $scope.sortedQuestionList = [];
            StatisticsFactory.getSortedQuestions($stateParams.assessmentId, $stateParams.username).then(
                function (sortedQuestionList) {
                    $scope.sortedQuestionList = sortedQuestionList;
                    console.debug(sortedQuestionList);
                }
            );


        }
    ]);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Sep 04 2016 12:54:56 GMT-0400 (Hora Padrão Brasil Central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
